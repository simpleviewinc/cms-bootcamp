<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Fetching</title>
  </head>
  <body>
    <ul class="movies"></ul>

    <script>
      const moviesEl = document.querySelector(".movies");
      const api = "https://ghibliapi.herokuapp.com/films/";

      async function call(promise) {
        let data;
        let error;
        let res;

        try {
          res = await promise;
          data = await res.json();

          if (!res.ok) {
            throw Error(`${res.status}: ${res.statusText}`);
          }
        }
        catch (err) {
          error = err;
        }

        return [data, error];
      }

      async function getMovies() {
        const [movies, err] = await call(fetch(api));

        if (err) {
          console.error(err);

          return;
        }

        moviesEl.innerHTML = movies.map(item => `<li>${item.title}</li>`).join('');
      }

      getMovies();
    </script>
  </body>
</html>
